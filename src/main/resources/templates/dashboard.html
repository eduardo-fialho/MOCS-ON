<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MOCS ON - Dashboard do Delegado</title>

  <!-- Tailwind CSS (CDN - apenas para testes; use build local em produção) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Alpine.js v3 (corrigido) -->
  <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>

  <!-- Google Fonts: Inter -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

  <style>
    body { font-family: 'Inter', sans-serif; }
    .bg-mocs-blue { background-color: #205395; }
    .text-mocs-blue { color: #205395; }
    .bg-mocs-orange { background-color: #FF8C00; }
    .text-mocs-orange { color: #FF8C00; }
    .border-mocs-blue { border-color: #205395; }
    .border-mocs-orange { border-color: #FF8C00; }

    .custom-scrollbar::-webkit-scrollbar { width: 8px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 10px; }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #a1a1aa; }
  </style>
</head>

<body class="bg-gray-100">
  <div class="flex flex-col min-h-screen">
    <!-- Cabeçalho -->
    <header class="bg-white shadow-md z-10 sticky top-0">
      <div class="container mx-auto px-4 py-3 flex justify-between items-center">
        <div class="flex items-center space-x-4">
          <a href="#"><img src="https://placehold.co/150x50/205395/ffffff?text=MOCS+ON" alt="Logo MOCS ON" class="h-8"></a>
        </div>
        <div class="flex items-center space-x-6">
          <span class="font-semibold text-gray-700 hidden sm:block">CSNU</span>
          <div class="relative" x-data="{ open: false }">
            <button @click="open = !open" class="flex items-center space-x-2">
              <img src="https://placehold.co/40x40/cccccc/ffffff?text=U" alt="Avatar" class="h-9 w-9 rounded-full border-2 border-mocs-blue">
              <span class="hidden md:block font-semibold text-gray-700">Delegado do Brasil</span>
              <i class="fas fa-chevron-down text-xs text-gray-500"></i>
            </button>
            <div x-show="open" @click.away="open = false" class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-20" style="display: none;">
              <a href="login.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Sair</a>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Conteúdo -->
    <main class="flex-grow container mx-auto p-4 md:p-6">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Coluna principal -->
        <div class="lg:col-span-2 flex flex-col gap-6">
          <div class="bg-white p-6 rounded-xl shadow-lg">
            <h2 class="text-2xl font-bold text-mocs-blue mb-4">Mural do Comitê - CSNU</h2>

            <!-- Formulário de Postagem -->
            <div class="mb-6">
              <textarea class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-mocs-blue" rows="3" placeholder="Escreva um post no mural, envie um spotted anônimo..."></textarea>
              <div class="flex justify-end items-center mt-2">
                <label class="text-sm text-gray-600 mr-4"><input type="checkbox" class="mr-2 rounded">Postar como anônimo (Spotted)</label>
                <button class="bg-mocs-blue text-white font-semibold py-2 px-5 rounded-lg hover:bg-opacity-90">Postar</button>
              </div>
            </div>

            <!-- Feed -->
            <div class="space-y-5">
              <!-- Exemplo de posts -->
              <div class="border-t pt-4">
                <div class="flex items-start space-x-4">
                  <div class="bg-mocs-orange text-white h-10 w-10 rounded-full flex items-center justify-center"><i class="fas fa-newspaper"></i></div>
                  <div>
                    <p class="font-bold text-gray-800">Jornal da Imprensa</p>
                    <p class="font-semibold text-gray-800 text-lg">Crise se intensifica: delegações buscam consenso no CSNU</p>
                    <p class="text-sm text-gray-600">Enquanto as negociações avançam, fontes indicam que um bloco de países está perto de apresentar a primeira proposta...</p>
                    <p class="text-xs text-gray-500 mt-1">15 minutos atrás</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Coluna lateral -->
        <div class="lg:col-span-1 flex flex-col gap-6" x-data="announcementsData()">
          <div class="bg-white p-6 rounded-xl shadow-lg">
            <h2 class="text-xl font-bold text-mocs-blue mb-4">Agenda do Dia</h2>
            <ul class="space-y-3">
              <li class="flex items-center gap-4">
                <i class="fas fa-check-circle text-green-500"></i>
                <div>
                  <p class="font-semibold text-gray-500 line-through">09:00 - 12:00</p>
                  <p class="text-sm text-gray-500 line-through">Sessão de Debate 1</p>
                </div>
              </li>
              <li class="flex items-center gap-4">
                <i class="fas fa-spinner fa-spin text-mocs-orange"></i>
                <div>
                  <p class="font-semibold">14:00 - 17:00</p>
                  <p class="text-sm text-gray-600">Sessão de Debate 2</p>
                </div>
              </li>
              <li class="flex items-center gap-4">
                <i class="far fa-circle text-gray-400"></i>
                <div>
                  <p class="font-semibold text-gray-400">17:00 - 17:30</p>
                  <p class="text-sm text-gray-400">Encerramento e Votações</p>
                </div>
              </li>
            </ul>
          </div>

          <!-- Avisos -->
          <div class="bg-white p-6 rounded-xl shadow-lg">
            <h2 class="text-xl font-bold text-mocs-blue mb-4">Avisos da Organização</h2>
            <div class="space-y-3" x-init="loadAvisos()">
              <div x-show="isLoading" class="text-center py-4 text-gray-500">
                <i class="fas fa-spinner fa-spin mr-2"></i> Carregando avisos...
              </div>
              <div x-show="!isLoading && !avisos.length" class="text-center py-4 text-gray-500">
                Nenhum aviso disponível.
              </div>

              <template x-for="aviso in paginatedAvisos" :key="aviso.titulo + aviso.data">
                <div class="border-t pt-3 cursor-pointer hover:bg-gray-50 rounded-lg px-2 py-1 transition duration-150" @click="showAvisoModal(aviso)">
                  <p class="font-semibold text-sm text-gray-800" x-text="aviso.titulo"></p>
                  <p class="text-xs text-gray-500" x-text="formatTimeAgo(aviso.data)"></p>
                </div>
              </template>
            </div>

            <!-- Paginação -->
            <div x-show="totalPages > 1" class="flex justify-between items-center mt-4 pt-3 border-t">
              <button @click="prevPage()" :disabled="currentPage === 1" class="bg-mocs-orange text-white text-sm font-semibold py-1 px-3 rounded-lg disabled:bg-gray-300 disabled:cursor-not-allowed">
                Anterior
              </button>
              <span class="text-sm text-gray-600">Página <span x-text="currentPage"></span> de <span x-text="totalPages"></span></span>
              <button @click="nextPage()" :disabled="currentPage >= totalPages" class="bg-mocs-orange text-white text-sm font-semibold py-1 px-3 rounded-lg disabled:bg-gray-300 disabled:cursor-not-allowed">
                Próxima
              </button>
            </div>
          </div>

          <!-- Modal -->
          <div x-show="isModalOpen" x-transition class="fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center p-4 z-50" style="display:none" @click.away="closeAvisoModal()">
            <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-lg mx-auto" @click.stop>
              <div class="flex justify-between items-start mb-4">
                <h3 class="text-2xl font-bold text-mocs-blue" x-text="currentAviso.titulo"></h3>
                <button @click="closeAvisoModal()" class="text-gray-400 hover:text-gray-600"><i class="fas fa-times text-xl"></i></button>
              </div>
              <p class="text-sm text-gray-500 mb-4 border-b pb-2">Postado por: <span class="font-semibold" x-text="currentAviso.autor"></span></p>
              <div class="max-h-96 custom-scrollbar overflow-y-auto pr-2">
                <p class="text-gray-700 whitespace-pre-wrap" x-text="currentAviso.mensagem"></p>
              </div>
              <div class="mt-6 flex justify-end">
                <button @click="closeAvisoModal()" class="bg-gray-200 text-gray-800 font-semibold py-2 px-4 rounded-lg hover:bg-gray-300">Fechar</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Script Lógica Alpine -->
  <script>
    const API_BASE_URL = 'http://localhost:8080';
    const API_ENDPOINT = API_BASE_URL + '/aviso';

    function announcementsData() {
      return {
        avisos: [],
        currentPage: 1,
        itemsPerPage: 5,
        isLoading: false,
        isModalOpen: false,
        currentAviso: { titulo: '', mensagem: '', autor: '', data: '' },

        get paginatedAvisos() {
          const start = (this.currentPage - 1) * this.itemsPerPage;
          const end = start + this.itemsPerPage;
          return this.avisos.slice(start, end);
        },
        get totalPages() {
          return Math.ceil(this.avisos.length / this.itemsPerPage);
        },
        nextPage() {
          if (this.currentPage < this.totalPages) this.currentPage++;
        },
        prevPage() {
          if (this.currentPage > 1) this.currentPage--;
        },
        showAvisoModal(aviso) {
          this.currentAviso = aviso;
          this.isModalOpen = true;
        },
        closeAvisoModal() {
          this.isModalOpen = false;
          this.currentAviso = { titulo: '', mensagem: '', autor: '', data: '' };
        },
        formatTimeAgo(dateString) {
          try {
            const postDate = new Date(dateString);
            const now = new Date();
            const diffInSeconds = Math.floor((now - postDate) / 1000);
            if (diffInSeconds < 60) return `${diffInSeconds} segundos atrás`;
            const diffInMinutes = Math.floor(diffInSeconds / 60);
            if (diffInMinutes < 60) return `${diffInMinutes} minutos atrás`;
            const diffInHours = Math.floor(diffInMinutes / 60);
            if (diffInHours < 24) return `${diffInHours} horas atrás`;
            const diffInDays = Math.floor(diffInHours / 24);
            if (diffInDays < 7) return `${diffInDays} dias atrás`;
            return postDate.toLocaleDateString('pt-BR', { day: 'numeric', month: 'short', year: 'numeric' });
          } catch {
            return 'Data inválida';
          }
        },
        async loadAvisos() {
          this.isLoading = true;
          try {
            const response = await fetch(API_ENDPOINT);
            if (!response.ok) throw new Error('Erro ao carregar avisos.');
            const data = await response.json();
            data.sort((a, b) => new Date(b.data) - new Date(a.data));
            this.avisos = data;
            this.currentPage = 1;
          } catch (error) {
            console.error('Falha ao buscar avisos:', error);
            this.avisos = [];
          } finally {
            this.isLoading = false;
          }
        }
      };
    }
  </script>
</body>
</html>
